<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交易界面</title>
    <style>
        body {
            background-color: white;
            font-family: Arial, sans-serif;
        }
        .container {
            width: 95%;
            margin: 0 auto;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        .button {
            background-color: #f0f0f0;
            border: none;
            padding: 10px 20px;
            margin: 5px 0;
            cursor: pointer;
            border-radius: 5px;
            display: block;
            width: 100%;
            box-sizing: border-box;
            color: black;
            font-size: 16px;
        }

        .button-leverage {
            background-color: #f0f0f0;
            border: none;
            padding: 10px 20px;
            margin: 5px 0;
            cursor: pointer;
            border-radius: 5px;
            display: block;
            width: 30%;
            box-sizing: border-box;
            color: black;
            font-size: 16px;
        }

        .button-row {
            display: flex;
            justify-content: space-between;
        }

        .button-row .button {
            width: 48%;
        }


        .toggle-button {
            display: flex;
            position: relative;
            margin: 5px 0;
            height: 40px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        .toggle-button button {
            width: 50%;
            z-index: 1;
            position: relative;
            background-color: transparent;
            border: none;
            padding: 10px;
            cursor: pointer;
            font-size: 16px;
            color: black;
        }
        .slider {
            position: absolute;
            top: 5%;
            height: 90%;
            background-color: #fff;
            border-radius: 5px;
            transition: 0.4s;
        }
        .margin-slider {
            width: 48%;
            left: 2%;
        }
        .toggle-button.active .margin-slider {
            left: 50%;
        }
        .stock-slider {
            width: 49%;
        }
        .toggle-button.active .stock-slider {
            left: 50%;
        }
        .button-buy {
            background-color: #4caf50;
            color: white;
        }
        .button-sell {
            background-color: #f44336;
            color: white;
        }
        .price-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }
        .price-control, .quantity-control {
            display: flex;
            align-items: center;
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow: hidden;
            width: 48%;
        }
        .price-control button, .quantity-control button {
            background-color: #fff;
            border: none;
            padding: 5px;
            font-size: 25px;
            cursor: pointer;
            color: black;
            width: 20%;
        }
        .price-control input, .quantity-control input {
            text-align: center;
            border: none;
            font-size: 20px;
            background-color: #fff;
            margin: 0;
            padding: 10px 0;
            width: 60%;
        }
        .quantity-control span {
            font-size: 12px;
            color: #999;
        }
        .info {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 16px;
        }
        .chart {
            height: 300px;
            margin: 20px 0;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            font-size: 16px;
        }
        /* 視窗樣式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 2;
            opacity: 0;
            transition: opacity 0.3s; /* 將 transition 時間設置為 0.3s */
        }
        .modal.show {
            display: flex;
            opacity: 1;
        }
        .modal-content {
            background-color: white;
            border-radius: 15px;
            width: 85%;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        .close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
            color: black;
        }
        .control-btn {
            font-size: 24px;
            padding: 5px 15px;
            margin: 0 10px;
            border: none;
            background-color: #f0f0f0;
            cursor: pointer;
            color: black;
            border-radius: 5px;
        }
        .multipliers {
            display: flex;
            overflow-x: scroll;
            margin: 20px 0;
            scrollbar-width: none; /* Firefox */
        }
        .multipliers::-webkit-scrollbar {
            display: none; /* Safari and Chrome */
        }
        .multiplier {
            padding: 10px;
            margin: 0 5px;
            cursor: pointer;
            white-space: nowrap;
            transition: background-color 0.3s, color 0.3s;
            border-radius: 10px; /* 保持圓角 */
        }
        .selected {
            background-color: black;
            color: white;
        }
        .confirm-btn {
            font-size: 18px;
            color: white;
            background-color: black;
            border: none;
            padding: 10px 60px;
            border-radius: 20px;
            cursor: pointer;
        }
        .modal-value {
            font-size: 48px;
            margin: 10px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chart">
            K線圖
        </div>
        <div class="button-row">
            <div class="toggle-button" id="margin-toggle">
                <button onclick="toggleMargin('left')">全倉</button>
                <button onclick="toggleMargin('right')">逐倉</button>
                <div class="slider margin-slider" id="margin-slider"></div>
            </div>
            <button class="button-leverage" id="leverage-button">1.00×</button>
        </div>
        <div class="toggle-button" id="toggle-button">
            <button onclick="toggleSlide('left')">整張</button>
            <button onclick="toggleSlide('right')">零股</button>
            <div class="slider stock-slider" id="slider" style="left: 1%;"></div>
        </div>
        <div class="price-container">
            <div class="price-control">
                <button onclick="adjustPrice(-1)">－</button>
                <input type="number" id="price-input" value="963.00">
                <button onclick="adjustPrice(1)">＋</button>
            </div>
            <div class="quantity-control">
                <button onclick="adjustQuantity(-1)">－</button>
                <input type="number" id="quantity-input" value="1">
                <span id="unit-label">張</span>
                <button onclick="adjustQuantity(1)">＋</button>
            </div>
        </div>
        <div class="info">
            <span>預估金額</span>
            <span id="estimated-amount">963,000</span>
        </div>
        <div class="info">
            <span>可用</span>
            <span>1,000</span>
        </div>

        <button class="button button-buy">買入（做多）</button>
        <button class="button button-sell">賣出（做空）</button>
    </div>

    <!-- 模態視窗 -->
    <div class="modal" id="leverage-modal">
        <div class="modal-content">
            <span class="close" id="modal-close">&times;</span>
            <div class="current" id="modal-current">當前 1.00×</div>
            <div class="modal-value">
                <button class="control-btn" id="modal-decrement">-</button>
                <span id="modal-value">1.00×</span>
                <button class="control-btn" id="modal-increment">+</button>
            </div>
            <div class="multipliers" id="modal-multipliers">
                <div class="multiplier selected">1×</div>
                <div class="multiplier">2×</div>
                <div class="multiplier">3×</div>
                <div class="multiplier">5×</div>
                <div class="multiplier">10×</div>
                <div class="multiplier">20×</div>
                <div class="multiplier">50×</div>
                <div class="multiplier">75×</div>
                <div class="multiplier">100×</div>
            </div>
            <button class="confirm-btn" id="modal-confirm">確認</button>
        </div>
    </div>

    <script>
        const leverageButton = document.getElementById('leverage-button');
        const leverageModal = document.getElementById('leverage-modal');
        const modalClose = document.getElementById('modal-close');
        const modalConfirm = document.getElementById('modal-confirm');
        const modalValueElement = document.getElementById('modal-value');
        const modalCurrentElement = document.getElementById('modal-current');
        const modalMultipliersElement = document.getElementById('modal-multipliers');
        const modalDecrementButton = document.getElementById('modal-decrement');
        const modalIncrementButton = document.getElementById('modal-increment');
        let currentValue = 1.00;
        let selectedValue = 1.00;

        leverageButton.addEventListener('click', () => {
            leverageModal.style.display = 'flex';
            setTimeout(() => {
                leverageModal.classList.add('show');
            }, 10); // 微小的延遲，讓瀏覽器有時間應用 display 屬性
            currentValue = selectedValue;
            modalValueElement.textContent = `${currentValue.toFixed(2)}×`;
            modalCurrentElement.textContent = `當前 ${selectedValue.toFixed(2)}×`;

            // 確保選中的倍率有正確的CSS class
            const selectedElement = document.querySelector('.selected');
            if (selectedElement) {
                selectedElement.classList.remove('selected');
            }
            Array.from(modalMultipliersElement.children).forEach(multiplier => {
                if (parseFloat(multiplier.textContent) === currentValue) {
                    multiplier.classList.add('selected');
                    multiplier.scrollIntoView({ behavior: 'smooth', inline: 'center' });
                }
            });
        });


        modalClose.addEventListener('click', () => {
            leverageModal.classList.remove('show');
            setTimeout(() => {
                leverageModal.style.display = 'none';
            }, 300); // 與 CSS transition 時間一致，確保淡出完成後隱藏視窗
        });

        modalConfirm.addEventListener('click', () => {
            selectedValue = currentValue;
            leverageButton.textContent = `${selectedValue.toFixed(2)}×`;
            leverageModal.classList.remove('show');
            setTimeout(() => {
                leverageModal.style.display = 'none';
            }, 300); // 與 CSS transition 時間一致，確保淡出完成後隱藏視窗
        });

        modalConfirm.addEventListener('click', () => {
            selectedValue = currentValue;
            leverageButton.textContent = `${selectedValue.toFixed(2)}×`;
            leverageModal.classList.remove('show');
        });

        function updateModalValue(newValue) {
            currentValue = newValue;
            modalValueElement.textContent = `${newValue.toFixed(2)}×`;
            const selectedElement = document.querySelector('.selected');
            if (selectedElement) {
                selectedElement.classList.remove('selected');
            }
            Array.from(modalMultipliersElement.children).forEach(multiplier => {
                if (parseFloat(multiplier.textContent) === newValue) {
                    multiplier.classList.add('selected');
                    multiplier.scrollIntoView({ behavior: 'smooth', inline: 'center' });
                }
            });
        }


        modalDecrementButton.addEventListener('click', () => {
            if (currentValue > 1) updateModalValue(currentValue - 1);
        });

        modalIncrementButton.addEventListener('click', () => {
            if (currentValue < 100) updateModalValue(currentValue + 1);
        });

        Array.from(modalMultipliersElement.children).forEach(multiplier => {
            multiplier.addEventListener('click', () => {
                const newValue = parseFloat(multiplier.textContent);
                updateModalValue(newValue);
            });
        });

        function toggleSlide(direction) {
            var slider = document.getElementById('slider');
            var unitLabel = document.getElementById('unit-label');
            if (direction === 'left') {
                slider.style.left = '1%';
                unitLabel.innerText = '張';
            } else {
                slider.style.left = '50%';
                unitLabel.innerText = '股';
            }
            updateEstimatedAmount();
        }

        function toggleMargin(direction) {
            var slider = document.getElementById('margin-slider');
            if (direction === 'left') {
                slider.style.left = '2%';
            } else {
                slider.style.left = '50%';
            }
        }

        function adjustPrice(direction) {
            var priceInput = document.getElementById('price-input');
            var price = parseFloat(priceInput.value);
            if (price < 10) {
                price += direction * 0.01;
            } else if (price < 50) {
                price += direction * 0.05;
            } else if (price < 100) {
                price += direction * 0.1;
            } else if (price < 500) {
                price += direction * 0.5;
            } else if (price < 1000) {
                price += direction * 1;
            } else {
                price += direction * 5;
            }
            if (price < 0) price = 0;
            priceInput.value = price.toFixed(2);
            updateEstimatedAmount();
        }

        function adjustQuantity(direction) {
            var quantityInput = document.getElementById('quantity-input');
            var quantity = parseInt(quantityInput.value);
            quantity += direction;
            if (quantity <= 0) quantity = 1;
            quantityInput.value = quantity;
            updateEstimatedAmount();
        }

        function updateEstimatedAmount() {
            var price = parseFloat(document.getElementById('price-input').value);
            var quantity = parseInt(document.getElementById('quantity-input').value);
            var unit = document.getElementById('unit-label').innerText;
            var estimatedAmount = price * quantity;
            if (unit === '張') {
                estimatedAmount *= 1000;
            }
            document.getElementById('estimated-amount').innerText = numberWithCommas(trimTrailingZeros(estimatedAmount.toFixed(2)));
        }

        function trimTrailingZeros(numStr) {
            return numStr.replace(/(\.\d*[1-9])0+$/, "$1").replace(/\.0+$/, "");
        }

        function numberWithCommas(x) {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        document.getElementById('price-input').addEventListener('input', function() {
            var priceInput = document.getElementById('price-input');
            var price = parseFloat(priceInput.value);
            if (isNaN(price) || price < 0) {
                priceInput.value = 0;
            } else {
                priceInput.value = price.toFixed(2);
            }
            updateEstimatedAmount();
        });

        document.getElementById('quantity-input').addEventListener('input', function() {
            var quantityInput = document.getElementById('quantity-input');
            var quantity = parseInt(quantityInput.value);

            if (isNaN(quantity) || quantity < 1) {
                quantityInput.value = 1;
            }
            updateEstimatedAmount();
        });
    </script>
</body>
</html>